{"version":3,"file":"basic-dropdown-content.js","sources":["../../src/components/basic-dropdown-content.ts"],"sourcesContent":["import { action } from '@ember/object';\nimport Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { getScrollParent } from '../utils/calculate-position.ts';\nimport {\n  distributeScroll,\n  getAvailableScroll,\n  getScrollDeltas,\n} from '../utils/scroll-helpers.ts';\nimport hasMoved from '../utils/has-moved.ts';\nimport { isTesting } from '@embroider/macros';\nimport { modifier } from 'ember-modifier';\nimport type { Dropdown, TRootEventType } from './basic-dropdown.ts';\nimport { runTask } from 'ember-lifeline';\n\nexport interface BasicDropdownContentSignature {\n  Element: Element;\n  Args: {\n    animationEnabled?: boolean;\n    transitioningInClass?: string;\n    transitionedInClass?: string;\n    transitioningOutClass?: string;\n    isTouchDevice?: boolean;\n    destination?: string;\n    destinationElement?: HTMLElement;\n    dropdown?: Dropdown;\n    renderInPlace?: boolean;\n    preventScroll?: boolean;\n    rootEventType?: TRootEventType;\n    top?: string | undefined;\n    left?: string | undefined;\n    right?: string | undefined;\n    width?: string | undefined;\n    height?: string | undefined;\n    otherStyles?: Record<string, string>;\n    hPosition?: string;\n    vPosition?: string;\n    dir?: string;\n    defaultClass?: string;\n    overlay?: boolean;\n    htmlTag?: string;\n    onFocusIn?: (dropdown?: Dropdown, event?: FocusEvent) => void;\n    onFocusOut?: (dropdown?: Dropdown, event?: FocusEvent) => void;\n    onMouseEnter?: (dropdown?: Dropdown, event?: MouseEvent) => void;\n    onMouseLeave?: (dropdown?: Dropdown, event?: MouseEvent) => void;\n    shouldReposition?: (\n      mutations: MutationRecord[],\n      dropdown?: Dropdown,\n    ) => boolean;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\ntype RootMouseDownHandler = (ev: MouseEvent | TouchEvent) => void;\n\nexport default class BasicDropdownContent extends Component<BasicDropdownContentSignature> {\n  transitioningInClass =\n    this.args.transitioningInClass || 'ember-basic-dropdown--transitioning-in';\n  transitionedInClass =\n    this.args.transitionedInClass || 'ember-basic-dropdown--transitioned-in';\n  transitioningOutClass =\n    this.args.transitioningOutClass ||\n    'ember-basic-dropdown--transitioning-out';\n  isTouchDevice =\n    this.args.isTouchDevice || Boolean(!!window && 'ontouchstart' in window);\n  dropdownId = `ember-basic-dropdown-content-${this.args.dropdown?.uniqueId}`;\n  private touchMoveEvent: TouchEvent | undefined;\n  private handleRootMouseDown?: RootMouseDownHandler;\n  private scrollableAncestors: Element[] = [];\n  private mutationObserver: MutationObserver | undefined;\n  @tracked private _contentWormhole?: Element;\n  @tracked animationClass = this.transitioningInClass;\n\n  get destinationElement(): Element | null {\n    if (this.args.destinationElement) {\n      return this.args.destinationElement;\n    }\n\n    if (!this.args.destination) {\n      return null;\n    }\n\n    const element = document.getElementById(this.args.destination);\n\n    if (element) {\n      return element;\n    }\n\n    if (this._contentWormhole) {\n      return (\n        this._contentWormhole.getRootNode() as HTMLElement\n      )?.querySelector('#' + this.args.destination);\n    }\n\n    return null;\n  }\n\n  get animationEnabled(): boolean {\n    const { animationEnabled: animationEnabledArg = true } = this.args;\n\n    return animationEnabledArg && !isTesting();\n  }\n\n  get positionStyles(): Record<string, string> {\n    const style: Record<string, string> = {};\n    if (this.args.top !== undefined) {\n      style['top'] = this.args.top;\n    }\n    if (this.args.left !== undefined) {\n      style['left'] = this.args.left;\n    }\n    if (this.args.right !== undefined) {\n      style['right'] = this.args.right;\n    }\n    if (this.args.width !== undefined) {\n      style['width'] = this.args.width;\n    }\n    if (this.args.height !== undefined) {\n      style['height'] = this.args.height;\n    }\n    return style;\n  }\n\n  /**\n   * Allows similair behaviour to `ember-composable-helpers`' `optional` helper.\n   * Avoids adding extra dependencies.\n   * Can be removed when the template `V1` compatability event handlers are removed.\n   *\n   * @see https://github.com/cibernox/ember-basic-dropdown/issues/498\n   * @memberof BasicDropdownContent\n   */\n  noop(): void {}\n\n  registerDropdownContentWormhole = modifier(\n    (dropdownContentWormhole: Element) => {\n      this._contentWormhole = dropdownContentWormhole;\n    },\n  );\n\n  respondToEvents = modifier(\n    (dropdownElement: Element): (() => void) => {\n      if (this.args.dropdown?.actions?.registerDropdownElement) {\n        this.args.dropdown.actions.registerDropdownElement(\n          dropdownElement as HTMLElement,\n        );\n      }\n\n      const selector = `[data-ebd-id=${this.args.dropdown?.uniqueId}-trigger]`;\n      let triggerElement: HTMLElement | null = null;\n      if (\n        typeof this.args.dropdown?.actions?.getTriggerElement === 'function'\n      ) {\n        triggerElement = this.args.dropdown?.actions?.getTriggerElement();\n      }\n      if (!triggerElement) {\n        triggerElement = document.querySelector(selector) as HTMLElement;\n      }\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      this.handleRootMouseDown = (e: MouseEvent | TouchEvent): any => {\n        const target = (e.composedPath?.()[0] || e.target) as Element;\n        if (target === null) return;\n        if (\n          hasMoved(e as TouchEvent, this.touchMoveEvent) ||\n          dropdownElement.contains(target) ||\n          (triggerElement && triggerElement.contains(target))\n        ) {\n          this.touchMoveEvent = undefined;\n          return;\n        }\n\n        if (dropdownIsValidParent(triggerElement, target, this.dropdownId)) {\n          this.touchMoveEvent = undefined;\n          return;\n        }\n\n        if (this.args.dropdown?.actions?.close) {\n          this.args.dropdown.actions.close(e, true);\n        }\n      };\n      document.addEventListener(\n        this.args.rootEventType || 'click',\n        this.handleRootMouseDown,\n        true,\n      );\n\n      // We need to register closing event on shadow dom element, otherwise all clicks inside a shadow dom are not closing the dropdown\n      let rootElement;\n      if (\n        this._contentWormhole &&\n        this._contentWormhole.getRootNode() instanceof ShadowRoot\n      ) {\n        rootElement = this._contentWormhole.getRootNode() as HTMLElement;\n      }\n\n      if (rootElement) {\n        rootElement.addEventListener(\n          this.args.rootEventType || 'click',\n          this.handleRootMouseDown,\n          true,\n        );\n      }\n\n      window.addEventListener('resize', this.runloopAwareReposition);\n      window.addEventListener('orientationchange', this.runloopAwareReposition);\n\n      if (this.isTouchDevice) {\n        document.addEventListener('touchstart', this.touchStartHandler, true);\n        document.addEventListener('touchend', this.handleRootMouseDown, true);\n\n        if (rootElement) {\n          rootElement.addEventListener(\n            'touchstart',\n            this.touchStartHandler,\n            true,\n          );\n          rootElement.addEventListener(\n            'touchend',\n            this.handleRootMouseDown,\n            true,\n          );\n        }\n      }\n      if (\n        triggerElement !== null &&\n        !(triggerElement.getRootNode() instanceof ShadowRoot)\n      ) {\n        this.scrollableAncestors = getScrollableAncestors(triggerElement);\n      }\n      this.addScrollHandling(dropdownElement);\n      return () => {\n        this.removeGlobalEvents();\n        this.removeScrollHandling();\n        this.scrollableAncestors = [];\n\n        document.removeEventListener(\n          this.args.rootEventType || 'click',\n          this.handleRootMouseDown as RootMouseDownHandler,\n          true,\n        );\n\n        let rootElement;\n        if (\n          this._contentWormhole &&\n          this._contentWormhole.getRootNode() instanceof ShadowRoot\n        ) {\n          rootElement = this._contentWormhole.getRootNode() as HTMLElement;\n        }\n\n        if (rootElement) {\n          rootElement.removeEventListener(\n            this.args.rootEventType || 'click',\n            this.handleRootMouseDown as RootMouseDownHandler,\n            true,\n          );\n        }\n\n        if (this.isTouchDevice) {\n          document.removeEventListener(\n            'touchstart',\n            this.touchStartHandler,\n            true,\n          );\n          document.removeEventListener(\n            'touchend',\n            this.handleRootMouseDown as RootMouseDownHandler,\n            true,\n          );\n\n          if (rootElement) {\n            rootElement.removeEventListener(\n              'touchstart',\n              this.touchStartHandler,\n              true,\n            );\n            rootElement.removeEventListener(\n              'touchend',\n              this.handleRootMouseDown as RootMouseDownHandler,\n              true,\n            );\n          }\n        }\n      };\n    },\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    { eager: false },\n  );\n\n  initiallyReposition = modifier(\n    () => {\n      // Escape autotracking frame and avoid backtracking re-render\n      Promise.resolve().then(() => {\n        this.args.dropdown?.actions.reposition();\n      });\n    },\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    { eager: false },\n  );\n\n  animateInAndOut = modifier(\n    (dropdownElement: Element): (() => void) => {\n      if (!this.animationEnabled) return () => {};\n      waitForAnimations(dropdownElement, () => {\n        this.animationClass = this.transitionedInClass;\n      });\n      return () => {\n        if (!this.animationEnabled) return;\n        let parentElement =\n          dropdownElement.parentElement ?? this.destinationElement;\n        if (parentElement === null) return;\n        if (this.args.renderInPlace) {\n          parentElement = parentElement.parentElement;\n        }\n        if (parentElement === null) return;\n        const clone = dropdownElement.cloneNode(true) as Element;\n        clone.id = `${clone.id}--clone`;\n        clone.classList.remove(...this.transitioningInClass.split(' '));\n        clone.classList.add(...this.transitioningOutClass.split(' '));\n        parentElement.appendChild(clone);\n        this.animationClass = this.transitioningInClass;\n        waitForAnimations(clone, function () {\n          (parentElement as HTMLElement).removeChild(clone);\n        });\n      };\n    },\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    { eager: false },\n  );\n\n  observeMutations = modifier(\n    (dropdownElement: Element): (() => void) => {\n      this.mutationObserver = new MutationObserver((mutations) => {\n        let shouldReposition = mutations.some(\n          (record: MutationRecord) =>\n            containsRelevantMutation(record.addedNodes) ||\n            containsRelevantMutation(record.removedNodes),\n        );\n\n        if (shouldReposition && this.args.shouldReposition) {\n          shouldReposition = this.args.shouldReposition(\n            mutations,\n            this.args.dropdown,\n          );\n        }\n\n        if (shouldReposition) {\n          this.runloopAwareReposition();\n        }\n      });\n      this.mutationObserver.observe(dropdownElement, {\n        childList: true,\n        subtree: true,\n      });\n      return () => {\n        if (this.mutationObserver !== undefined) {\n          this.mutationObserver.disconnect();\n          this.mutationObserver = undefined;\n        }\n      };\n    },\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    { eager: false },\n  );\n\n  @action\n  touchStartHandler(): void {\n    document.addEventListener('touchmove', this.touchMoveHandler, true);\n\n    if (\n      this._contentWormhole &&\n      this._contentWormhole.getRootNode() instanceof ShadowRoot\n    ) {\n      const rootElement = this._contentWormhole.getRootNode() as HTMLElement;\n      rootElement.addEventListener('touchmove', this.touchMoveHandler, true);\n    }\n  }\n\n  @action\n  touchMoveHandler(e: TouchEvent): void {\n    this.touchMoveEvent = e;\n    document.removeEventListener('touchmove', this.touchMoveHandler, true);\n\n    if (\n      this._contentWormhole &&\n      this._contentWormhole.getRootNode() instanceof ShadowRoot\n    ) {\n      const rootElement = this._contentWormhole.getRootNode() as HTMLElement;\n      rootElement.removeEventListener('touchmove', this.touchMoveHandler, true);\n    }\n  }\n\n  @action\n  runloopAwareReposition(): void {\n    if (!this.args.dropdown) {\n      return;\n    }\n\n    runTask(this, () => {\n      if (!this.args.dropdown) {\n        return;\n      }\n\n      this.args.dropdown.actions.reposition();\n    });\n  }\n\n  @action\n  removeGlobalEvents(): void {\n    window.removeEventListener('resize', this.runloopAwareReposition);\n    window.removeEventListener(\n      'orientationchange',\n      this.runloopAwareReposition,\n    );\n  }\n\n  // Methods\n  addScrollHandling(dropdownElement: Element): void {\n    if (this.args.preventScroll === true) {\n      const wheelHandler = (event: WheelEvent) => {\n        const target = (event.composedPath?.()[0] || event.target) as Element;\n        if (target === null) return;\n        if (\n          dropdownElement.contains(target) ||\n          dropdownElement === event.target\n        ) {\n          // Discover the amount of scrollable canvas that is within the dropdown.\n          const availableScroll = getAvailableScroll(target, dropdownElement);\n\n          // Calculate what the event's desired change to that scrollable canvas is.\n          let { deltaX, deltaY } = getScrollDeltas(event);\n\n          // If the consequence of the wheel action would result in scrolling beyond\n          // the scrollable canvas of the dropdown, call preventDefault() and clamp\n          // the value of the delta to the available scroll size.\n          if (deltaX < availableScroll.deltaXNegative) {\n            deltaX = availableScroll.deltaXNegative;\n            event.preventDefault();\n          } else if (deltaX > availableScroll.deltaXPositive) {\n            deltaX = availableScroll.deltaXPositive;\n            event.preventDefault();\n          } else if (deltaY < availableScroll.deltaYNegative) {\n            deltaY = availableScroll.deltaYNegative;\n            event.preventDefault();\n          } else if (deltaY > availableScroll.deltaYPositive) {\n            deltaY = availableScroll.deltaYPositive;\n            event.preventDefault();\n          }\n\n          // Add back in the default behavior for the two good states that the above\n          // `preventDefault()` code will break.\n          // - Two-axis scrolling on a one-axis scroll container\n          // - The last relevant wheel event if the scroll is overshooting\n\n          // Also, don't attempt to do this if both of `deltaX` or `deltaY` are 0.\n          if (event.defaultPrevented && (deltaX || deltaY)) {\n            distributeScroll(deltaX, deltaY, target, dropdownElement);\n          }\n        } else {\n          // Scrolling outside of the dropdown is prohibited.\n          event.preventDefault();\n        }\n      };\n      document.addEventListener('wheel', wheelHandler, {\n        capture: true,\n        passive: false,\n      });\n\n      if (\n        this._contentWormhole &&\n        this._contentWormhole.getRootNode() instanceof ShadowRoot\n      ) {\n        const rootElement = this._contentWormhole.getRootNode() as HTMLElement;\n        rootElement.addEventListener('wheel', wheelHandler, {\n          capture: true,\n          passive: false,\n        });\n      }\n\n      this.removeScrollHandling = () => {\n        document.removeEventListener('wheel', wheelHandler, { capture: true });\n\n        if (\n          this._contentWormhole &&\n          this._contentWormhole.getRootNode() instanceof ShadowRoot\n        ) {\n          const rootElement =\n            this._contentWormhole.getRootNode() as HTMLElement;\n          rootElement.removeEventListener('wheel', wheelHandler, {\n            capture: true,\n          });\n        }\n      };\n    } else {\n      this.addScrollEvents();\n      this.removeScrollHandling = this.removeScrollEvents;\n    }\n  }\n\n  // Assigned at runtime to ensure that changes to the `preventScroll` property\n  // don't result in not cleaning up after ourselves.\n  removeScrollHandling(): void {}\n\n  // These two functions wire up scroll handling if `preventScroll` is false.\n  // These trigger reposition of the dropdown.\n  addScrollEvents(): void {\n    window.addEventListener('scroll', this.runloopAwareReposition);\n    this.scrollableAncestors.forEach((el) => {\n      el.addEventListener('scroll', this.runloopAwareReposition);\n    });\n  }\n  removeScrollEvents(): void {\n    window.removeEventListener('scroll', this.runloopAwareReposition);\n    this.scrollableAncestors.forEach((el) => {\n      el.removeEventListener('scroll', this.runloopAwareReposition);\n    });\n  }\n}\n\nfunction containsRelevantMutation(nodeList: NodeList): boolean {\n  for (let i = 0; i < nodeList.length; i++) {\n    const node = nodeList[i];\n    if (\n      node !== undefined &&\n      node.nodeName !== '#comment' &&\n      !(node.nodeName === '#text' && node.nodeValue === '')\n    ) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// All ancestors with scroll (except the BODY, which is treated differently)\nfunction getScrollableAncestors(triggerElement: Element): Element[] {\n  const scrollableAncestors = [];\n  if (triggerElement) {\n    const parent = triggerElement.parentNode;\n    if (parent !== null) {\n      let nextScrollable: Element | undefined = getScrollParent(\n        parent as Element,\n      );\n      while (\n        nextScrollable &&\n        nextScrollable.tagName.toUpperCase() !== 'BODY' &&\n        nextScrollable.tagName.toUpperCase() !== 'HTML'\n      ) {\n        scrollableAncestors.push(nextScrollable);\n        const nextParent = nextScrollable.parentNode;\n        if (nextParent === null) {\n          nextScrollable = undefined;\n        } else {\n          nextScrollable = getScrollParent(nextParent as Element);\n        }\n      }\n    }\n  }\n  return scrollableAncestors;\n}\n\nfunction closestContent(el: Element): Element | null {\n  while (\n    el &&\n    (!el.classList || !el.classList.contains('ember-basic-dropdown-content'))\n  ) {\n    if (el.parentElement === null) return null;\n    el = el.parentElement;\n  }\n  return el;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unsafe-function-type\nfunction waitForAnimations(element: Element, callback: Function): void {\n  window.requestAnimationFrame(function () {\n    const computedStyle = window.getComputedStyle(element);\n    if (\n      computedStyle.animationName !== 'none' &&\n      computedStyle.animationPlayState === 'running'\n    ) {\n      const eventCallback = function () {\n        element.removeEventListener('animationend', eventCallback);\n        callback();\n      };\n      element.addEventListener('animationend', eventCallback);\n    } else {\n      callback();\n    }\n  });\n}\n\n/**\n * Evaluates if the given element is in a dropdown or any of its parent dropdowns.\n *\n * @param {any} owner\n * @param {HTMLElement} el\n * @param {String} dropdownId\n */\nfunction dropdownIsValidParent(\n  triggerElement: HTMLElement | null,\n  el: Element,\n  dropdownId: string,\n): boolean {\n  const closestDropdown = closestContent(el);\n  if (closestDropdown === null) {\n    return false;\n  } else {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const closestAttrs = closestDropdown.attributes as unknown as any;\n    const selector = `[aria-controls=${closestAttrs.id.value}]`;\n    const trigger =\n      document.querySelector(selector) ??\n      (triggerElement?.getRootNode() as HTMLElement)?.querySelector(selector);\n    if (trigger === null) return false;\n    const parentDropdown = closestContent(trigger);\n    if (parentDropdown === null) return false;\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const parentAttrs = parentDropdown.attributes as unknown as any;\n    return (\n      (parentDropdown && parentAttrs.id.value === dropdownId) ||\n      dropdownIsValidParent(triggerElement, parentDropdown, dropdownId)\n    );\n  }\n}\n"],"names":["BasicDropdownContent","Component","transitioningInClass","args","transitionedInClass","transitioningOutClass","isTouchDevice","Boolean","window","dropdownId","dropdown","uniqueId","touchMoveEvent","handleRootMouseDown","scrollableAncestors","mutationObserver","g","prototype","tracked","i","void 0","destinationElement","destination","element","document","getElementById","_contentWormhole","getRootNode","querySelector","animationEnabled","animationEnabledArg","isTesting","positionStyles","style","top","undefined","left","right","width","height","noop","registerDropdownContentWormhole","modifier","dropdownContentWormhole","respondToEvents","dropdownElement","actions","registerDropdownElement","selector","triggerElement","getTriggerElement","e","target","composedPath","hasMoved","contains","dropdownIsValidParent","close","addEventListener","rootEventType","rootElement","ShadowRoot","runloopAwareReposition","touchStartHandler","getScrollableAncestors","addScrollHandling","removeGlobalEvents","removeScrollHandling","removeEventListener","eager","initiallyReposition","Promise","resolve","then","reposition","animateInAndOut","waitForAnimations","animationClass","parentElement","renderInPlace","clone","cloneNode","id","classList","remove","split","add","appendChild","removeChild","observeMutations","MutationObserver","mutations","shouldReposition","some","record","containsRelevantMutation","addedNodes","removedNodes","observe","childList","subtree","disconnect","touchMoveHandler","n","action","runTask","preventScroll","wheelHandler","event","availableScroll","getAvailableScroll","deltaX","deltaY","getScrollDeltas","deltaXNegative","preventDefault","deltaXPositive","deltaYNegative","deltaYPositive","defaultPrevented","distributeScroll","capture","passive","addScrollEvents","removeScrollEvents","forEach","el","nodeList","length","node","nodeName","nodeValue","parent","parentNode","nextScrollable","getScrollParent","tagName","toUpperCase","push","nextParent","closestContent","callback","requestAnimationFrame","computedStyle","getComputedStyle","animationName","animationPlayState","eventCallback","closestDropdown","closestAttrs","attributes","value","trigger","parentDropdown","parentAttrs","setComponentTemplate","TEMPLATE"],"mappings":"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"}