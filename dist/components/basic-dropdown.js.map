{"version":3,"file":"basic-dropdown.js","sources":["../../src/components/basic-dropdown.ts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action } from '@ember/object';\nimport { guidFor } from '@ember/object/internals';\nimport { scheduleTask } from 'ember-lifeline';\nimport calculatePosition from '../utils/calculate-position.ts';\nimport type {\n  CalculatePosition,\n  CalculatePositionResult,\n  HorizontalPosition,\n  VerticalPosition,\n} from '../utils/calculate-position.ts';\nimport { getOwner } from '@ember/application';\nimport type Owner from '@ember/owner';\nimport type { ComponentLike } from '@glint/template';\nimport type { BasicDropdownTriggerSignature } from './basic-dropdown-trigger.ts';\nimport type { BasicDropdownContentSignature } from './basic-dropdown-content.ts';\n\nexport interface DropdownActions {\n  toggle: (e?: Event) => void;\n  close: (e?: Event, skipFocus?: boolean) => void;\n  open: (e?: Event) => void;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  reposition: (...args: any[]) => undefined | RepositionChanges;\n  registerTriggerElement: (e: HTMLElement) => void;\n  registerDropdownElement: (e: HTMLElement) => void;\n  getTriggerElement: () => HTMLElement | null;\n}\nexport interface Dropdown {\n  uniqueId: string;\n  disabled: boolean;\n  isOpen: boolean;\n  actions: DropdownActions;\n}\n\nexport type TRootEventType = 'click' | 'mousedown';\n\nconst UNINITIALIZED = {};\nconst IGNORED_STYLES = ['top', 'left', 'right', 'width', 'height'];\ninterface BasicDropdownSignature {\n  Element: HTMLElement;\n  Args: BasicDropdownArgs;\n  Blocks: {\n    default: [\n      {\n        uniqueId: string;\n        disabled: boolean;\n        isOpen: boolean;\n        actions: DropdownActions;\n        Trigger: ComponentLike<BasicDropdownTriggerSignature>;\n        Content: ComponentLike<BasicDropdownContentSignature>;\n      },\n    ];\n  };\n}\n\ninterface BasicDropdownArgs {\n  initiallyOpened?: boolean;\n  renderInPlace?: boolean;\n  verticalPosition?: VerticalPosition;\n  horizontalPosition?: HorizontalPosition;\n  destination?: string;\n  destinationElement?: HTMLElement;\n  disabled?: boolean;\n  dropdownId?: string;\n  rootEventType?: TRootEventType;\n  preventScroll?: boolean;\n  matchTriggerWidth?: boolean;\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-function-type\n  onInit?: Function;\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-function-type\n  registerAPI?: Function;\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-function-type\n  onOpen?: Function;\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-function-type\n  onClose?: Function;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  triggerComponent?: string | ComponentLike<any> | undefined;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  contentComponent?: string | ComponentLike<any> | undefined;\n  calculatePosition?: CalculatePosition;\n}\n\ntype RepositionChanges = {\n  hPosition: HorizontalPosition;\n  vPosition: VerticalPosition;\n  otherStyles: Record<string, string | number | undefined>;\n  top?: string | undefined;\n  left?: string | undefined;\n  right?: string | undefined;\n  width?: string | undefined;\n  height?: string | undefined;\n};\n\nexport default class BasicDropdown extends Component<BasicDropdownSignature> {\n  @tracked hPosition: HorizontalPosition | null = null;\n  @tracked vPosition: VerticalPosition | null = null;\n  @tracked top: string | undefined;\n  @tracked left: string | undefined;\n  @tracked right: string | undefined;\n  @tracked width: string | undefined;\n  @tracked height: string | undefined;\n  @tracked otherStyles: Record<string, string | number | undefined> = {};\n  @tracked isOpen = this.args.initiallyOpened || false;\n  @tracked renderInPlace =\n    this.args.renderInPlace !== undefined ? this.args.renderInPlace : false;\n  private previousVerticalPosition?: VerticalPosition | undefined;\n  private previousHorizontalPosition?: HorizontalPosition | undefined;\n  private triggerElement: HTMLElement | null = null;\n  private dropdownElement: HTMLElement | null = null;\n\n  private _uid = guidFor(this);\n  private _dropdownId: string =\n    this.args.dropdownId || `ember-basic-dropdown-content-${this._uid}`;\n  private _previousDisabled = UNINITIALIZED;\n  private _actions: DropdownActions = {\n    open: this.open,\n    close: this.close,\n    toggle: this.toggle,\n    reposition: this.reposition,\n    registerTriggerElement: this.registerTriggerElement,\n    registerDropdownElement: this.registerDropdownElement,\n    getTriggerElement: () => this.triggerElement,\n  };\n\n  private get horizontalPosition() {\n    return this.args.horizontalPosition || 'auto'; // auto-right | right | center | left\n  }\n\n  private get verticalPosition() {\n    return this.args.verticalPosition || 'auto'; // above | below\n  }\n\n  get destination(): string {\n    return this.args.destination || this._getDestinationId();\n  }\n\n  get destinationElement(): HTMLElement | null {\n    if (this.args.destinationElement) {\n      return this.args.destinationElement;\n    }\n\n    const element = document.getElementById(this.destination);\n\n    if (element) {\n      return element;\n    }\n\n    if (\n      this.triggerElement &&\n      this.triggerElement.getRootNode() instanceof ShadowRoot\n    ) {\n      return (this.triggerElement.getRootNode() as HTMLElement)?.querySelector(\n        `#${this.destination}`,\n      );\n    }\n\n    return null;\n  }\n\n  get disabled(): boolean {\n    const newVal = this.args.disabled || false;\n    if (\n      this._previousDisabled !== UNINITIALIZED &&\n      this._previousDisabled !== newVal\n    ) {\n      scheduleTask(this, 'actions', () => {\n        if (newVal && this.publicAPI.isOpen) {\n          // eslint-disable-next-line ember/no-side-effects\n          this.isOpen = false;\n        }\n        if (this.args.registerAPI) {\n          this.args.registerAPI(this.publicAPI);\n        }\n      });\n    }\n    // eslint-disable-next-line ember/no-side-effects\n    this._previousDisabled = newVal;\n    return newVal;\n  }\n\n  get publicAPI(): Dropdown {\n    return {\n      uniqueId: this._uid,\n      isOpen: this.isOpen,\n      disabled: this.disabled,\n      actions: this._actions,\n    };\n  }\n\n  // Lifecycle hooks\n  constructor(owner: Owner, args: BasicDropdownArgs) {\n    super(owner, args);\n    if (this.args.onInit) {\n      this.args.onInit(this.publicAPI);\n    }\n    if (this.args.registerAPI) {\n      this.args.registerAPI(this.publicAPI);\n    }\n  }\n\n  override willDestroy(): void {\n    super.willDestroy();\n    if (this.args.registerAPI) {\n      this.args.registerAPI(null);\n    }\n  }\n\n  // Actions\n  @action\n  open(e?: Event): void {\n    if (this.isDestroyed) {\n      return;\n    }\n    if (this.publicAPI.disabled || this.publicAPI.isOpen) {\n      return;\n    }\n    if (this.args.onOpen && this.args.onOpen(this.publicAPI, e) === false) {\n      return;\n    }\n    this.isOpen = true;\n    if (this.args.registerAPI) {\n      this.args.registerAPI(this.publicAPI);\n    }\n    const trigger = this._getTriggerElement();\n    if (trigger) {\n      const parent = trigger.parentElement;\n      if (parent) {\n        parent.setAttribute('aria-owns', this._dropdownId);\n      }\n    }\n  }\n\n  @action\n  close(e?: Event, skipFocus?: boolean): void {\n    if (this.isDestroyed) {\n      return;\n    }\n    if (this.publicAPI.disabled || !this.publicAPI.isOpen) {\n      return;\n    }\n    if (this.args.onClose && this.args.onClose(this.publicAPI, e) === false) {\n      return;\n    }\n    if (this.isDestroyed) {\n      return; // To check that the `onClose` didn't destroy the dropdown\n    }\n    this.hPosition = this.vPosition = null;\n    this.top = this.left = this.right = this.width = this.height = undefined;\n    this.previousVerticalPosition = this.previousHorizontalPosition = undefined;\n    this.isOpen = false;\n    if (this.args.registerAPI) {\n      this.args.registerAPI(this.publicAPI);\n    }\n    const trigger = this._getTriggerElement();\n    if (!trigger) {\n      return;\n    }\n    const parent = trigger.parentElement;\n    if (parent) {\n      parent.removeAttribute('aria-owns');\n    }\n    if (skipFocus) {\n      return;\n    }\n    if (trigger.tabIndex > -1) {\n      trigger.focus();\n    }\n  }\n\n  @action\n  toggle(e?: Event): void {\n    if (this.publicAPI.isOpen) {\n      this.close(e);\n    } else {\n      this.open(e);\n    }\n  }\n\n  @action\n  reposition(): undefined | RepositionChanges {\n    if (!this.publicAPI.isOpen) {\n      return;\n    }\n    const dropdownElement = this._getDropdownElement();\n    const triggerElement = this._getTriggerElement();\n    if (!dropdownElement || !triggerElement || !this.destinationElement) {\n      return;\n    }\n\n    const {\n      horizontalPosition,\n      verticalPosition,\n      previousHorizontalPosition,\n      previousVerticalPosition,\n    } = this;\n    const { renderInPlace = false, matchTriggerWidth = false } = this.args;\n    const calculatePositionFn =\n      this.args.calculatePosition || calculatePosition;\n    const positionData = calculatePositionFn(\n      triggerElement,\n      dropdownElement,\n      this.destinationElement,\n      {\n        horizontalPosition,\n        verticalPosition,\n        previousHorizontalPosition,\n        previousVerticalPosition,\n        renderInPlace,\n        matchTriggerWidth,\n        dropdown: this,\n      },\n    );\n    return this.applyReposition(triggerElement, dropdownElement, positionData);\n  }\n\n  @action\n  registerTriggerElement(element: HTMLElement): void {\n    this.triggerElement = element;\n  }\n\n  @action\n  registerDropdownElement(element: HTMLElement): void {\n    this.dropdownElement = element;\n  }\n\n  applyReposition(\n    _trigger: Element,\n    dropdown: HTMLElement,\n    positions: CalculatePositionResult,\n  ): RepositionChanges {\n    const changes: RepositionChanges = {\n      hPosition: positions.horizontalPosition,\n      vPosition: positions.verticalPosition,\n      otherStyles: Object.assign({}, this.otherStyles),\n    };\n\n    if (positions.style) {\n      if (positions.style.top !== undefined) {\n        changes.top = `${positions.style.top}px`;\n      }\n      // The component can be aligned from the right or from the left, but not from both.\n      if (positions.style.left !== undefined) {\n        changes.left = `${positions.style.left}px`;\n        changes.right = undefined;\n        // Since we set the first run manually we may need to unset the `right` property.\n        if (positions.style.right !== undefined) {\n          positions.style.right = undefined;\n        }\n      } else if (positions.style.right !== undefined) {\n        changes.right = `${positions.style.right}px`;\n        changes.left = undefined;\n      }\n      if (positions.style.width !== undefined) {\n        changes.width = `${positions.style.width}px`;\n      }\n      if (positions.style.height !== undefined) {\n        changes.height = `${positions.style.height}px`;\n      }\n      if (this.top === undefined) {\n        // Bypass Ember on the first reposition only to avoid flickering.\n        for (const prop in positions.style) {\n          if (positions.style[prop] !== undefined) {\n            if (typeof positions.style[prop] === 'number') {\n              dropdown.style.setProperty(prop, `${positions.style[prop]}px`);\n            } else {\n              dropdown.style.setProperty(prop, `${positions.style[prop]}`);\n            }\n          }\n        }\n      }\n    }\n    for (const prop in positions.style) {\n      if (!IGNORED_STYLES.includes(prop)) {\n        changes.otherStyles[prop] = positions.style[prop];\n      }\n    }\n\n    this.hPosition = changes.hPosition;\n    this.vPosition = changes.vPosition;\n    this.top = changes.top;\n    this.left = changes.left;\n    this.right = changes.right;\n    this.width = changes.width;\n    this.height = changes.height;\n    this.otherStyles = changes.otherStyles;\n    this.previousHorizontalPosition = positions.horizontalPosition;\n    this.previousVerticalPosition = positions.verticalPosition;\n    return changes;\n  }\n\n  _getDestinationId(): string {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    const config = getOwner(this).resolveRegistration('config:environment') as {\n      environment: string;\n      APP: {\n        rootElement: string;\n      };\n      'ember-basic-dropdown': {\n        destination: string;\n      };\n    };\n\n    if (config.environment === 'test') {\n      // document doesn't exists in fastboot apps, for this reason we need this check\n      if (typeof document === 'undefined') {\n        return 'ember-basic-dropdown-wormhole';\n      }\n      const rootElement = config['APP']?.rootElement;\n      return (\n        document.querySelector(rootElement)?.id ??\n        'ember-basic-dropdown-wormhole'\n      );\n    }\n\n    return ((config['ember-basic-dropdown'] &&\n      config['ember-basic-dropdown'].destination) ||\n      'ember-basic-dropdown-wormhole') as string;\n  }\n\n  _getDropdownElement(): HTMLElement | null {\n    if (this.dropdownElement) {\n      return this.dropdownElement;\n    }\n\n    return document.querySelector(`[id=\"${this._dropdownId}\"]`);\n  }\n\n  _getTriggerElement(): HTMLElement | null {\n    if (this.triggerElement) {\n      return this.triggerElement;\n    }\n\n    return document.querySelector(\n      `[data-ebd-id=${this.publicAPI.uniqueId}-trigger]`,\n    );\n  }\n}\n"],"names":["UNINITIALIZED","IGNORED_STYLES","BasicDropdown","Component","g","prototype","tracked","i","void 0","args","initiallyOpened","renderInPlace","undefined","previousVerticalPosition","previousHorizontalPosition","triggerElement","dropdownElement","_uid","guidFor","_dropdownId","dropdownId","_previousDisabled","_actions","open","close","toggle","reposition","registerTriggerElement","registerDropdownElement","getTriggerElement","horizontalPosition","verticalPosition","destination","_getDestinationId","destinationElement","element","document","getElementById","getRootNode","ShadowRoot","querySelector","disabled","newVal","scheduleTask","publicAPI","isOpen","registerAPI","uniqueId","actions","constructor","owner","onInit","willDestroy","e","isDestroyed","onOpen","trigger","_getTriggerElement","parent","parentElement","setAttribute","n","action","skipFocus","onClose","hPosition","vPosition","top","left","right","width","height","removeAttribute","tabIndex","focus","_getDropdownElement","matchTriggerWidth","calculatePositionFn","calculatePosition","positionData","dropdown","applyReposition","_trigger","positions","changes","otherStyles","Object","assign","style","prop","setProperty","includes","config","getOwner","resolveRegistration","environment","rootElement","id","setComponentTemplate","TEMPLATE"],"mappings":"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"}