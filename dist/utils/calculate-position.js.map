{"version":3,"file":"calculate-position.js","sources":["../../src/utils/calculate-position.ts"],"sourcesContent":["export type VerticalPosition = 'auto' | 'above' | 'below';\nexport type HorizontalPosition =\n  | 'auto'\n  | 'auto-right'\n  | 'auto-left'\n  | 'left'\n  | 'right'\n  | 'center';\n\nexport interface CalculatePositionOptions {\n  horizontalPosition: HorizontalPosition;\n  verticalPosition: VerticalPosition;\n  matchTriggerWidth: boolean;\n  previousHorizontalPosition?: HorizontalPosition | undefined;\n  previousVerticalPosition?: VerticalPosition | undefined;\n  renderInPlace: boolean;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  dropdown: any;\n}\nexport type CalculatePositionResultStyle = {\n  top?: number | undefined;\n  left?: number | undefined;\n  right?: number | undefined;\n  width?: number | undefined;\n  height?: number | undefined;\n  [key: string]: string | number | undefined;\n};\nexport type CalculatePositionResult = {\n  horizontalPosition: HorizontalPosition;\n  verticalPosition: VerticalPosition;\n  style: CalculatePositionResultStyle;\n};\nexport type CalculatePosition = (\n  trigger: Element,\n  content: HTMLElement,\n  destination: HTMLElement,\n  options: CalculatePositionOptions,\n) => CalculatePositionResult;\n\nexport const calculateWormholedPosition: CalculatePosition = (\n  trigger,\n  content,\n  destination,\n  {\n    horizontalPosition,\n    verticalPosition,\n    matchTriggerWidth,\n    previousHorizontalPosition,\n    previousVerticalPosition,\n  },\n) => {\n  // Collect information about all the involved DOM elements\n  const scroll = { left: window.pageXOffset, top: window.pageYOffset };\n  let { left: triggerLeft, top: triggerTop } = trigger.getBoundingClientRect();\n  const { width: triggerWidth, height: triggerHeight } =\n    trigger.getBoundingClientRect();\n  const { height: dropdownHeight } = content.getBoundingClientRect();\n  let { width: dropdownWidth } = content.getBoundingClientRect();\n  const viewportWidth = document.body.clientWidth || window.innerWidth;\n  const style: CalculatePositionResultStyle = {};\n\n  // Apply containers' offset\n  let anchorElement = destination.parentNode as HTMLElement;\n\n  if (anchorElement instanceof ShadowRoot) {\n    anchorElement = anchorElement.host as HTMLElement;\n  }\n\n  let anchorPosition = window.getComputedStyle(anchorElement).position;\n  while (\n    anchorPosition !== 'relative' &&\n    anchorPosition !== 'absolute' &&\n    anchorElement.tagName.toUpperCase() !== 'BODY' &&\n    !(anchorElement.parentNode instanceof ShadowRoot)\n  ) {\n    anchorElement = anchorElement.parentNode as HTMLElement;\n    anchorPosition = window.getComputedStyle(anchorElement).position;\n  }\n  if (anchorPosition === 'relative' || anchorPosition === 'absolute') {\n    const rect = anchorElement.getBoundingClientRect();\n    triggerLeft = triggerLeft - rect.left;\n    triggerTop = triggerTop - rect.top;\n    const { offsetParent } = anchorElement;\n    if (offsetParent) {\n      triggerLeft -= offsetParent.scrollLeft;\n      triggerTop -= offsetParent.scrollTop;\n    }\n  }\n\n  // Calculate drop down width\n  dropdownWidth = matchTriggerWidth ? triggerWidth : dropdownWidth;\n  if (matchTriggerWidth) {\n    style.width = dropdownWidth;\n  }\n\n  /**\n   * Fixes bug where the dropdown always stays on the same position on the screen when\n   * the <body> is relatively positioned\n   */\n  const isBodyPositionRelative =\n    window.getComputedStyle(document.body).getPropertyValue('position') ===\n    'relative';\n\n  // Calculate horizontal position\n  let triggerLeftWithScroll = triggerLeft;\n\n  if (!isBodyPositionRelative) {\n    triggerLeftWithScroll += scroll.left;\n  }\n\n  if (horizontalPosition === 'auto' || horizontalPosition === 'auto-left') {\n    // Calculate the number of visible horizontal pixels if we were to place the\n    // dropdown on the left and right\n    const leftVisible =\n      Math.min(viewportWidth, triggerLeft + dropdownWidth) -\n      Math.max(0, triggerLeft);\n    const rightVisible =\n      Math.min(viewportWidth, triggerLeft + triggerWidth) -\n      Math.max(0, triggerLeft + triggerWidth - dropdownWidth);\n\n    if (dropdownWidth > leftVisible && rightVisible > leftVisible) {\n      // If the drop down won't fit left-aligned, and there is more space on the\n      // right than on the left, then force right-aligned\n      horizontalPosition = 'right';\n    } else if (dropdownWidth > rightVisible && leftVisible > rightVisible) {\n      // If the drop down won't fit right-aligned, and there is more space on\n      // the left than on the right, then force left-aligned\n      horizontalPosition = 'left';\n    } else {\n      // Keep same position as previous\n      horizontalPosition = previousHorizontalPosition || 'left';\n    }\n  } else if (horizontalPosition === 'auto-right') {\n    // Calculate the number of visible horizontal pixels if we were to place the\n    // dropdown on the left and right\n    const leftVisible =\n      Math.min(viewportWidth, triggerLeft + dropdownWidth) -\n      Math.max(0, triggerLeft);\n    const rightVisible =\n      Math.min(viewportWidth, triggerLeft + triggerWidth) -\n      Math.max(0, triggerLeft + triggerWidth - dropdownWidth);\n\n    if (dropdownWidth > rightVisible && leftVisible > rightVisible) {\n      // If the drop down won't fit right-aligned, and there is more space on the\n      // left than on the right, then force left-aligned\n      horizontalPosition = 'left';\n    } else if (dropdownWidth > leftVisible && rightVisible > leftVisible) {\n      // If the drop down won't fit left-aligned, and there is more space on\n      // the right than on the left, then force right-aligned\n      horizontalPosition = 'right';\n    } else {\n      // Keep same position as previous\n      horizontalPosition = previousHorizontalPosition || 'right';\n    }\n  }\n  if (horizontalPosition === 'right') {\n    style.right = viewportWidth - (triggerLeftWithScroll + triggerWidth);\n  } else if (horizontalPosition === 'center') {\n    style.left = triggerLeftWithScroll + (triggerWidth - dropdownWidth) / 2;\n  } else {\n    style.left = triggerLeftWithScroll;\n  }\n\n  // Calculate vertical position\n  let triggerTopWithScroll = triggerTop;\n\n  if (!isBodyPositionRelative) {\n    triggerTopWithScroll += scroll.top;\n  }\n\n  if (verticalPosition === 'above') {\n    style.top = triggerTopWithScroll - dropdownHeight;\n  } else if (verticalPosition === 'below') {\n    style.top = triggerTopWithScroll + triggerHeight;\n  } else {\n    const viewportBottom = scroll.top + window.innerHeight;\n    const enoughRoomBelow =\n      triggerTopWithScroll + triggerHeight + dropdownHeight < viewportBottom;\n    const enoughRoomAbove = triggerTop > dropdownHeight;\n\n    if (!enoughRoomBelow && !enoughRoomAbove) {\n      verticalPosition = 'below';\n    } else if (\n      previousVerticalPosition === 'below' &&\n      !enoughRoomBelow &&\n      enoughRoomAbove\n    ) {\n      verticalPosition = 'above';\n    } else if (\n      previousVerticalPosition === 'above' &&\n      !enoughRoomAbove &&\n      enoughRoomBelow\n    ) {\n      verticalPosition = 'below';\n    } else if (!previousVerticalPosition) {\n      verticalPosition = enoughRoomBelow ? 'below' : 'above';\n    } else {\n      verticalPosition = previousVerticalPosition;\n    }\n    style.top =\n      triggerTopWithScroll +\n      (verticalPosition === 'below' ? triggerHeight : -dropdownHeight);\n  }\n\n  return { horizontalPosition, verticalPosition, style };\n};\n\nexport const calculateInPlacePosition: CalculatePosition = (\n  trigger,\n  content,\n  _destination,\n  { horizontalPosition, verticalPosition },\n) => {\n  let dropdownRect;\n  const positionData: CalculatePositionResult = {\n    horizontalPosition: 'left',\n    verticalPosition: 'below',\n    style: {},\n  };\n  if (horizontalPosition === 'auto') {\n    const triggerRect = trigger.getBoundingClientRect();\n    dropdownRect = content.getBoundingClientRect();\n    const viewportRight = window.pageXOffset + window.innerWidth;\n    positionData.horizontalPosition =\n      triggerRect.left + dropdownRect.width > viewportRight ? 'right' : 'left';\n  } else if (horizontalPosition === 'center') {\n    const { width: triggerWidth } = trigger.getBoundingClientRect();\n    const { width: dropdownWidth } = content.getBoundingClientRect();\n    positionData.style = { left: (triggerWidth - dropdownWidth) / 2 };\n  } else if (horizontalPosition === 'auto-right') {\n    const triggerRect = trigger.getBoundingClientRect();\n    const dropdownRect = content.getBoundingClientRect();\n    positionData.horizontalPosition =\n      triggerRect.right > dropdownRect.width ? 'right' : 'left';\n  } else if (horizontalPosition === 'right') {\n    positionData.horizontalPosition = 'right';\n  }\n\n  if (verticalPosition === 'above') {\n    positionData.verticalPosition = verticalPosition;\n    dropdownRect = dropdownRect || content.getBoundingClientRect();\n    positionData.style.top = -dropdownRect.height;\n  } else {\n    positionData.verticalPosition = 'below';\n  }\n  return positionData;\n};\n\nexport function getScrollParent(element: Element) {\n  let style = window.getComputedStyle(element);\n  const excludeStaticParent = style.position === 'absolute';\n  const overflowRegex = /(auto|scroll)/;\n\n  if (style.position === 'fixed') return document.body;\n  for (\n    let parent: Element | null = element;\n    (parent = parent.parentElement);\n\n  ) {\n    style = window.getComputedStyle(parent);\n    if (excludeStaticParent && style.position === 'static') {\n      continue;\n    }\n    if (\n      overflowRegex.test(style.overflow + style.overflowY + style.overflowX)\n    ) {\n      return parent;\n    }\n  }\n\n  return document.body;\n}\nconst calculatePosition: CalculatePosition = (\n  trigger,\n  content,\n  destination,\n  options,\n) => {\n  if (options.renderInPlace) {\n    return calculateInPlacePosition(trigger, content, destination, options);\n  } else {\n    return calculateWormholedPosition(trigger, content, destination, options);\n  }\n};\n\nexport default calculatePosition;\n"],"names":["calculateWormholedPosition","trigger","content","destination","horizontalPosition","verticalPosition","matchTriggerWidth","previousHorizontalPosition","previousVerticalPosition","scroll","left","window","pageXOffset","top","pageYOffset","triggerLeft","triggerTop","getBoundingClientRect","width","triggerWidth","height","triggerHeight","dropdownHeight","dropdownWidth","viewportWidth","document","body","clientWidth","innerWidth","style","anchorElement","parentNode","ShadowRoot","host","anchorPosition","getComputedStyle","position","tagName","toUpperCase","rect","offsetParent","scrollLeft","scrollTop","isBodyPositionRelative","getPropertyValue","triggerLeftWithScroll","leftVisible","Math","min","max","rightVisible","right","triggerTopWithScroll","viewportBottom","innerHeight","enoughRoomBelow","enoughRoomAbove","calculateInPlacePosition","_destination","dropdownRect","positionData","triggerRect","viewportRight","getScrollParent","element","excludeStaticParent","overflowRegex","parent","parentElement","test","overflow","overflowY","overflowX","calculatePosition","options","renderInPlace"],"mappings":"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"}